<%= javascript_include_tag 'moment.min.js' %>
<%= javascript_include_tag 'fullcalendar.min.js' %>

<script type="text/javascript">
	$(document).ready(function() {

        // Handle data when pop up window is closed
        $('#event_modal').on('hidden.bs.modal', function(event){
            var event_object = {
                title: $('#event_name').val(),
                start: $('#date-message-header').text(),
                notes: $('#event_notes').val(),
                backgroundColor: "#5e80bf"
            };
            // Reset pop form values
            $('#event_name').val('').end();
            $('#event_notes').val('').end();
            $('#date-message-header').val('').end();
            $('#calendar').fullCalendar('renderEvent', event_object);

            // Make AJAX call to post data to rails
            $.ajax({
                type: "POST",
                url: "post_event",
                data: event_object
            });
        });
                
        $('#calendar').fullCalendar({

            // Load data from rails


        	// Event handler for day clicks
            dayClick: function(date, jsEvent) {
                $('#event_modal').modal('show');
                $('#date-message-header').text(date.format());
        	},

        	// Event handler for event clicks
        	eventClick: function(calEvent, jsEvent, view){
        		var formattedDate = moment(calEvent.start).format('MM-DD-YYYY');
        		alert('Event: ' + calEvent.title + "\n" + 'Date: ' + formattedDate + "\n" + 'Notes: ' + calEvent.notes);
        	}
        });

    });
</script>

<div class="row">
    <div class="col-md-7" id='calendar'></div>
    <div class="col-md-3 col-md-offset-1">
        <div class="supporting_tips">
            <h4><i class="fa fa-lightbulb-o fa-lg"></i> Quick Tip:</h4>
            <span>Click on a day to create a new event </span>
        </div>
        <hr/>
        <table class="table upcoming" style="width:100%;height:200px;border:2px solid black">
            <th>
                Upcoming tasks
            </th>
        </table>
    </div>
</div>

<!-- Render Pop up window -->
<%= render 'event_modal' %>